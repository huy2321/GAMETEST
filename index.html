<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vẽ nhân vật</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    canvas {
        border: 1px solid #000;
        cursor: crosshair;
        display: block;
        margin: 20px auto;
    }
    .toolbar {
        text-align: center;
        margin-bottom: 20px;
    }
    .toolbar button {
        padding: 10px 20px;
        margin: 0 5px;
        font-size: 16px;
        cursor: pointer;
    }
    .canvas-pencil-cursor {
        cursor: url('./img/pencil-1581_Wa2qgFNcG.png') 3 25, auto;
    }
    .color-picker {
        margin-top: 10px;
    }
    .color-box {
        display: inline-block;
        width: 20px;
        height: 20px;
        margin: 0 5px;
        border: 1px solid #000;
        cursor: pointer;
    }
</style>
</head>
<body>
<h1>Vẽ nhân vật của bạn</h1>
<div class="toolbar">
    <button onclick="clearCanvas()">Xóa</button>
    <button onclick="saveImage()">Lưu</button>
    <input type="color" id="colorPicker" class="color-picker" value="#000000" onchange="setColor(this.value)">
    <button onclick="setTool('pen')">Bút vẽ</button>
    <button onclick="setTool('eraser')">Tẩy</button><br> 
    <br>
    <div class="color-palette">
        <div class="color-box" style="background-color: yellow" onclick="setColor('yellow')"></div>
        <div class="color-box" style="background-color: white" onclick="setColor('white')"></div>
        <div class="color-box" style="background-color: red" onclick="setColor('red')"></div>
        <div class="color-box" style="background-color: black" onclick="setColor('black')"></div>
        <div class="color-box" style="background-color: purple" onclick="setColor('purple')"></div>
        <div class="color-box" style="background-color: cyan" onclick="setColor('cyan')"></div>
        <div class="color-box" style="background-color: brown" onclick="setColor('brown')"></div>
        <div class="color-box" style="background-color: green" onclick="setColor('green')"></div>
    </div>
</div>
<label for="charName">Tên nhân vật:</label>
<input type="text" id="charName" name="charName" required>
<canvas id="myCanvas" width="300" height="300"></canvas>
<script>
    const canvas = document.getElementById('myCanvas');
    const context = canvas.getContext('2d');
    const charNameInput = document.getElementById('charName');
    const colorPicker = document.getElementById('colorPicker');

    let currentColor = '#000000'; // Màu vẽ hiện tại, mặc định là đen
    let currentTool = 'pen'; // Công cụ vẽ hiện tại, mặc định là bút vẽ

    const gridSize = 10; // Kích thước của mỗi ô vuông

    let painting = false;

    function startPosition(e) {
        painting = true;
        draw(e);
    }

    function endPosition() {
        painting = false;
        context.beginPath();
    }

    function draw(e) {
        if (!painting) return;

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const gridX = Math.floor(x / gridSize) * gridSize; // Tính toán vị trí ô vuông
        const gridY = Math.floor(y / gridSize) * gridSize;

        if (currentTool === 'pen') {
            context.fillStyle = currentColor; // Sử dụng màu vẽ hiện tại
        } else if (currentTool === 'eraser') {
            context.fillStyle = '#ffffff'; // Màu nền của canvas để tẩy
        }

        context.fillRect(gridX, gridY, gridSize, gridSize); // Vẽ ô vuông

        // Vẽ đường viền xung quanh ô vuông
        context.strokeStyle = '#ccc'; // Màu đường viền
        context.strokeRect(gridX, gridY, gridSize, gridSize);

        context.stroke();
    }

    function clearCanvas() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid(); // Vẽ lại lưới ô vuông sau khi xóa
    }

    function saveImage() {
        if (charNameInput.value.trim() === '') {
            alert('Vui lòng nhập tên nhân vật.');
            return;
        }

        const dataURL = canvas.toDataURL();
        const a = document.createElement('a');
        a.href = dataURL;
        a.download = charNameInput.value.trim() + '_character.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function setColor(color) {
        currentColor = color;
    }

    function setTool(tool) {
        currentTool = tool;
    }

    function drawGrid() {
        for (let x = 0; x < canvas.width; x += gridSize) {
            for (let y = 0; y < canvas.height; y += gridSize) {
                context.strokeStyle = '#ccc'; // Màu đường viền
                context.strokeRect(x, y, gridSize, gridSize);
            }
        }
    }

    canvas.addEventListener('mousedown', startPosition);
    canvas.addEventListener('mouseup', endPosition);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseenter', setPencilCursor);
    canvas.addEventListener('mouseleave', resetCursor);

    drawGrid(); // Vẽ lưới ô vuông ban đầu

    function setPencilCursor() {
        canvas.classList.add('canvas-pencil-cursor');
    }

    function resetCursor() {
        canvas.classList.remove('canvas-pencil-cursor');
    }
</script>
</body>
</html>
